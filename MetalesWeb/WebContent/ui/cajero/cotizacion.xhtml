<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">





<ui:composition template="/ui/template/cajeroTemplate.xhtml">
	<ui:define name="content">

<h:head>
<link type="text/css" rel="stylesheet" href="#{request.contextPath}/css/compra/compraMetal.css" />



</h:head>

<f:event listener="#{compraView.initConversation()}"
  type="preRenderView"></f:event>





<h:form id="cotizacionForm">

<p:growl id="growl" showDetail="true"  life="4500" autoUpdate="true"></p:growl>



<table width="90%" align="center">
	<tr>
		<td>		
			<table width="100%"  >
			
			<tr>
				<td valign="top">
				<table width="100%" >
					<tr>
						<td class="encabezadocampo">PRODUCTO *
					</td>
					</tr>
					<tr>
						<td>
						<p:selectOneMenu id="comboProducto" value="#{cotizacionView.idProductoSeleccionado}" tabindex="1">
							<f:selectItem itemLabel="Seleccione un producto" itemValue="0"/>
							<f:selectItems value="#{cotizacionView.productos}" var="producto" itemLabel="#{producto.nombre}" itemValue="#{producto.id}" />
							<p:ajax update="@form:valorText, @form:vistaFormularioCotizacion, @form:vistaFormularioCotizacionDiamante"
							 event="change"	listener="#{cotizacionView.eventProductoSeleccionado()}" />	
						</p:selectOneMenu>
					</td>
					</tr>
					
				</table>
				</td>
				<td valign="top">
					<p:panel id="vistaFormularioCotizacionDiamante" style="border: 0px">
						<f:subview id="subViewFormularioDiamante" rendered="#{cotizacionView.diamanteSeleccionado}">
							<br/>
							<table cellspacing="5px" width="95%" >
								<tr >	
									<td class="encabezadocampo" width="50%">CATEGORIA *
									</td>								
									<td class="encabezadocampo" width="50%">LIMPIEZA *
									</td>
																	
									
									
								</tr>								
								<tr >	
									<td  width="50%">
											<p:selectOneMenu id="comboCategoria" value="#{cotizacionView.diamateCotizado.punto.id}" tabindex="100"
											style="width:70%; ">
												<f:selectItem itemLabel="Seleccione una categoría" itemValue="0"/>
												<f:selectItems value="#{cotizacionView.puntosDiamante}" var="punto" 
															   itemLabel="#{punto.rangoPuntos}" itemValue="#{punto.id}" />
												<p:ajax update="@form:valorText" event="change"	
														listener="#{cotizacionView.eventCotizar()}" />	
											</p:selectOneMenu>
									</td>								
									<td  width="50%">
											<p:selectOneMenu id="comboLimpieza" value="#{cotizacionView.diamateCotizado.limpieza.id}" tabindex="101"
											style="width:70%; ">
												<f:selectItem itemLabel="Seleccione la limpieza" itemValue="0"/>
												<f:selectItems value="#{cotizacionView.limpiezaDiamante}" var="limpieza" 
															   itemLabel="#{limpieza.limpieza}" itemValue="#{limpieza.id}" />
												<p:ajax update="@form:valorText" event="change"	
														listener="#{cotizacionView.eventCotizar()}" />	
											</p:selectOneMenu>
									</td>
																	
									
									
								</tr>
								<tr>
									<td class="encabezadocampo" width="50%">COLOR *
									</td>	
									<td class="encabezadocampo"  width="50%">QUILATES *
									</td>
								</tr>
								<tr>
									<td  width="50%">
											<p:selectOneMenu id="comboColor" value="#{cotizacionView.diamateCotizado.color.id}" tabindex="102"
											style="width:70%; ">
												<f:selectItem itemLabel="Seleccione un color" itemValue="0"/>
												<f:selectItems value="#{cotizacionView.colorDiamante}" var="color" 
															   itemLabel="#{color.color}" itemValue="#{color.id}" />
												<p:ajax update="@form:valorText" event="change"	
														listener="#{cotizacionView.eventCotizar()}" />	
											</p:selectOneMenu>
									</td>	
									<td  width="50%">
										<p:inputText id="pesoDiamante" value="#{cotizacionView.diamateCotizado.quilates}" tabindex="103"
													 style="width:70%; text-align:right"
										>
											<f:validateDoubleRange maximum="99999.99" minimum="0.01" ></f:validateDoubleRange>
											<p:ajax update="@form:valorText" event="blur"	listener="#{cotizacionView.eventCotizar()}" />
										</p:inputText>
									</td>
									
								</tr>
								<tr>
									<td colspan="4" class="encabezadocampo" >
										DESCRIPCIÓN *
									</td>
								
								</tr>
								<tr>
									<td colspan="2" >
										<p:inputTextarea id="descripcionDiamante" style="width: 100%" 
										maxlength="250" value="#{cotizacionView.diamateCotizado.descripcion}" tabindex="104"/>												
										
									</td>
									<td colspan="2" >
									</td>
								
								</tr>
							</table>
						
						</f:subview>
					</p:panel>
					
					
						<p:panel id="vistaFormularioCotizacion" style="border: 0px">
							<f:subview id="subViewFormularioMetal" rendered="#{cotizacionView.metalSeleccionado}">
								<table cellspacing="10 px" width="95%">
									<tr >	
										<td class="encabezadocampo" width="20%">PORCENTAJE PUREZA *
										</td>									
										<td class="encabezadocampo" width="20%">PESO BRUTO <span class="textoPequeno">(gramos)</span> *
										</td>
										<td class="encabezadocampo" width="20%">PESO NETO <span class="textoPequeno">(gramos)</span>  *
										</td>
										
								
									</tr>
									<tr>
										<td>
											<p:inputText   value="#{cotizacionView.articuloMetalCotizacion.porcentajePureza}" id="porcentajePureza" tabindex="301"
											style="text-align:right">
												
												<f:validateDoubleRange maximum="100" minimum="1" ></f:validateDoubleRange>
												<p:ajax update="@form:valorText" event="blur" listener="#{cotizacionView.eventCotizar()}" />	
														
											</p:inputText> 
											
										</td>
										<td>
											<p:inputText value="#{cotizacionView.articuloMetalCotizacion.pesoBruto}" id="pesoBruto" tabindex="302" 
											style="text-align:right">
												<f:validateDoubleRange maximum="99999.99" minimum="0.05" ></f:validateDoubleRange>
												<p:ajax update="pesoNeto, @form:valorText " event="blur"	listener="#{cotizacionView.eventCotizar()}" />				
											</p:inputText> 
											
										</td>
										<td>
											<p:inputText id="pesoNeto" value="#{cotizacionView.articuloMetalCotizacion.pesoNeto}" tabindex="303"
											style="text-align:right">
												<f:validateDoubleRange maximum="99999.99" minimum="0.05" ></f:validateDoubleRange>
												<p:ajax update="@form:valorText" event="blur"	listener="#{cotizacionView.eventCotizar()}" />	
											</p:inputText> 
											
										</td>	
																					
									</tr>
									<tr>
										<td class="encabezadocampo" width="60%" colspan="3">DESCRIPCION *
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<p:inputTextarea id="descripcionMetal" style="width:60%"  
											maxlength="250" value="#{cotizacionView.articuloMetalCotizacion.descripcion}" tabindex="304"/>												
											
										</td>
									</tr>
								</table>
							</f:subview>
						</p:panel>
					
				</td>
				<td valign="top">
					<table width="100%">
						<tr>
							<td class="encabezadocampo" style="text-align:left;">VALOR
							</td>
							<td class="encabezadocampo" style="width:20%">SEGURIBOLSA *
							</td>
							<td>
							</td>	
								
						</tr>
						<tr>
							<td style="text-align:left;">
							
							<p:outputLabel value="#{cotizacionView.cotizacionFormateada()}" id="valorText" class="totalDineroCotizacion"></p:outputLabel>
								
								
							</td>	
							
							<td style="width:20%">
								<h:inputText maxlength="10" value="#{cotizacionView.seguribolsa}" tabindex="401"></h:inputText>
							</td>
							<td style="text-align: right;" class="totalDineroCotizacion">						
								<p:commandButton action="#{cotizacionView.eventAgregarArticulo()}"  iconPos="right"
						                 value="AGREGAR" icon="ui-icon-check" update="@form:vistaTabla,
						                 @form:vistaFormularioCotizacion, @form:vistaFormularioCotizacionDiamante, @form:comboProducto ,@form:valorText "
						                 tabindex="401"
						                  >			
									</p:commandButton>				
								</td>
							
							
							
						</tr>
					
					</table>
				</td>
			
			</tr>
			
			
			</table>			
		
		</td>
	</tr>
	<tr>
		<td>
			
			
			<br></br>
			<br></br>
			
			<p:panel id="vistaTabla" style="border: 0px">
			<f:subview id="subViewLista" rendered="#{compraView.mostrarTabla()}">
				<center>
				<hr />
				<table cellspacing="10px">
					<tr>
						<td style="text-align: right; padding-right: 10px">	
							<p:commandButton action="#{compraView.navegacionCliente()}" value="SIGUIENTE" icon="ui-icon-circle-triangle-e" iconPos="right"
							                 rendered="#{compraView.mostrarTabla()}" styleClass="callToAction" tabindex="501">
							</p:commandButton>
						</td>
					</tr>
					<tr>
						<td style="text-align: right; padding-right: 10px" class="totalDineroCompra">
							<br/>
							
							Total: <p:outputLabel value="#{compraView.totalValuacionArticulos}" styleClass="totalDineroCompra">  </p:outputLabel>
							
							<br/>
						</td>
											
					</tr>
					<tr>
						
					</tr>
					<tr>
						<td >					
							<p:dataTable   rendered="#{compraView.mostrarTabla()}" value="#{compraView.compra.articulos}" var="articulo" id="tablaArticulos" >
								<p:column headerText="QUITAR" width="5%" style="text-align:center;">
									<p:commandLink id="articulo" update="@form:vistaTabla" actionListener="#{cotizacionView.eventQuitarArticulo(articulo.llaveBolsaArticulo())}">
							        <h:outputText value="X" style="color: red; font-weight: bold" />
							    </p:commandLink>
								</p:column>
								<p:column headerText="SEGURIBOLSA" width="12%" style="text-align:right;">
									<h:outputText value="#{articulo.seguribolsa.codigo}" />
								</p:column>
								<p:column headerText="PRODUCTO" width="40%">
									<h:outputText value="#{articulo}" />
								</p:column>
								<p:column headerText="DESCRIPCION" width="40%">
									<h:outputText value="#{articulo.descripcion}" />
								</p:column>
								<p:column headerText="VALOR" width="10%" style="text-align: right;">
									<span style="text-align: right; padding-right: 8%">
										<h:outputText value="#{articulo.valorFormateado}"  />
									</span>
								</p:column>
							</p:dataTable>
						</td>
					</tr>				
				</table>	
				</center>
			</f:subview>
			</p:panel>
	
			
		</td>
	</tr>
</table>

<br></br>

	
</h:form>

</ui:define>
</ui:composition>
</html>

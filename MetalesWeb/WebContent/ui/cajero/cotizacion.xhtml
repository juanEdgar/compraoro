<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">





<ui:composition template="/ui/template/cajeroTemplate.xhtml">
	<ui:define name="content">

<h:head>
<link type="text/css" rel="stylesheet" href="#{request.contextPath}/css/compra/compraMetal.css" />



</h:head>

<f:event listener="#{compraView.initConversation()}"
  type="preRenderView"></f:event>





<h:form id="cotizacionForm">

<p:growl id="growl" showDetail="true"  life="4500" autoUpdate="true"></p:growl>



<table width="90%" align="center">
	<tr>
		<td>		
			<table width="100%">
			<tr >	
					<td class="encabezadocampo">Producto *
					</td>
					<td class="encabezadocampo">Bolsa Seguridad *
					</td>	
					<td class="encabezadocampo" style="text-align: right;">Cotización
					</td>
					
					<td></td>									
				
			
				</tr>
				<tr> 
					<td>
						<p:selectOneMenu id="comboProducto" value="#{cotizacionView.idProductoSeleccionado}" tabindex="1">
							<f:selectItem itemLabel="Seleccione un producto" itemValue="0"/>
							<f:selectItems value="#{cotizacionView.productos}" var="producto" itemLabel="#{producto.nombre}" itemValue="#{producto.id}" />
							<p:ajax update="@form:valorText, @form:vistaFormularioCotizacion" event="change"	listener="#{cotizacionView.eventProductoSeleccionado()}" />	
						</p:selectOneMenu>
					</td>
					<td>
						<h:inputText maxlength="10" value="#{cotizacionView.seguribolsa}"></h:inputText>
					</td>
					<td style="text-align: right;">
					
					<p:outputLabel value="#{cotizacionView.cotizacionFormateada()}" id="valorText" class="totalDineroCotizacion"></p:outputLabel>
						
						
					</td>					
					<td style="text-align: right;" class="totalDineroCotizacion">						
								<p:commandButton action="#{cotizacionView.eventAgregarArticulo()}"  iconPos="right"
						                 value="AGREGAR PRODUCTO" icon="ui-icon-check" update="@form:vistaTabla,
						                 @form:vistaFormularioCotizacion, @form:comboProducto ,@form:valorText "
						                  >			
						</p:commandButton>				
					</td>
					
				</tr>
				<tr>
					<td colspan="4">
						<p:panel id="vistaFormularioCotizacion" style="border: 0px">
							<f:subview id="subViewFormularioMetal" rendered="#{cotizacionView.metalSeleccionado}">
								<table cellspacing="10 px" width="95%">
									<tr >	
										<td class="encabezadocampo" width="20%">Porcentaje de pureza *
										</td>									
										<td class="encabezadocampo" width="20%">Peso Bruto *
										</td>
										<td class="encabezadocampo" width="20%">Peso  Neto*
										</td>
										<td class="encabezadocampo" width="20%">Descripción*
										</td>
								
									</tr>
									<tr>
										<td>
											<p:inputText   value="#{cotizacionView.articuloMetalCotizacion.porcentajePureza}" id="porcentajePureza" tabindex="2">
												
												<f:validateDoubleRange maximum="100" minimum="1" ></f:validateDoubleRange>
												<p:ajax update="@form:valorText" event="blur" listener="#{cotizacionView.eventCotizar()}" />	
														
											</p:inputText> 
											<span class="textoPequeno">%</span> 
										</td>
										<td>
											<p:inputText value="#{cotizacionView.articuloMetalCotizacion.pesoBruto}" id="pesoBruto" tabindex="3" >
												<f:validateDoubleRange maximum="99999.99" minimum="0.05" ></f:validateDoubleRange>
												<p:ajax update="pesoNeto, @form:valorText " event="blur"	listener="#{cotizacionView.eventCotizar()}" />				
											</p:inputText> 
											<span class="textoPequeno">gramos</span> 
										</td>
										<td>
											<p:inputText id="pesoNeto" value="#{cotizacionView.articuloMetalCotizacion.pesoNeto}" tabindex="4">
												<f:validateDoubleRange maximum="99999.99" minimum="0.05" ></f:validateDoubleRange>
												<p:ajax update="@form:valorText" event="blur"	listener="#{cotizacionView.eventCotizar()}" />	
											</p:inputText> 
											<span class="textoPequeno">gramos</span> 
										</td>	
										<td>
											<p:inputTextarea id="descripcionMetal" style="width: 100%"  maxlength="250" value="#{cotizacionView.articuloMetalCotizacion.descripcion}" tabindex="5"/>												
											
										</td>											
									</tr>
								</table>
							</f:subview>
						</p:panel>
					</td>
				</tr>
				<tr>
					<td colspan="3" align="right">
						
					</td>
				</tr>
			</table>			
		
		</td>
	</tr>
	<tr>
		<td>
			
			
			<br></br>
			<br></br>
			
			<p:panel id="vistaTabla" style="border: 0px">
			<f:subview id="subViewLista" rendered="#{compraView.mostrarTabla()}">
				<center>
				<hr />
				<table cellspacing="10px">
					<tr>
						<td style="text-align: right; padding-right: 10px">	
							<p:commandButton action="#{compraView.navegacionCliente()}" value="SIGUIENTE" icon="ui-icon-circle-triangle-e" iconPos="right"
							                 rendered="#{compraView.mostrarTabla()}" styleClass="callToAction" tabindex="7">
							</p:commandButton>
						</td>
					</tr>
					<tr>
						<td style="text-align: right; padding-right: 10px" class="totalDineroCompra">
							Total: <p:outputLabel value="#{compraView.totalValuacionArticulos}" styleClass="totalDineroCompra">  </p:outputLabel>
						</td>
											
					</tr>
					<tr>
						
					</tr>
					<tr>
						<td >					
							<p:dataTable   rendered="#{compraView.mostrarTabla()}" value="#{compraView.compra.articulos}" var="articulo" id="tablaArticulos" >
								<p:column headerText="QUITAR" width="5%" style="text-align:center;">
									<p:commandLink id="articulo" update="@form:vistaTabla" actionListener="#{cotizacionView.eventQuitarArticulo(articulo.llaveBolsaArticulo())}">
							        <h:outputText value="X" style="color: red; font-weight: bold" />
							    </p:commandLink>
								</p:column>
								<p:column headerText="SEGURIBOLSA" width="12%">
									<h:outputText value="#{articulo.seguribolsa.codigo}" />
								</p:column>
								<p:column headerText="PRODUCTO" width="30%">
									<h:outputText value="#{articulo}" />
								</p:column>
								<p:column headerText="DESCRIPCION" width="50">
									<h:outputText value="#{articulo.descripcion}" />
								</p:column>
								<p:column headerText="VALOR" width="10%" style="text-align: right;">
									<span style="text-align: right; padding-right: 5%">
										<h:outputText value="#{articulo.valorFormateado}"  />
									</span>
								</p:column>
							</p:dataTable>
						</td>
					</tr>				
				</table>	
				</center>
			</f:subview>
			</p:panel>
	
			
		</td>
	</tr>
</table>

<br></br>

	
</h:form>

</ui:define>
</ui:composition>
</html>
